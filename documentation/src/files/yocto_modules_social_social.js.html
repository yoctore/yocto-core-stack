<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>yocto_modules/social/social.js - yocto-core-stack</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="icon" href="../assets/favicon.ico">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
                <h1><img src="../assets/css/logo.png" title="yocto-core-stack" width="117" height="52"></h1>
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 0.0.1</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
                    <h2 class="off-left">APIs</h2>
                    <div id="api-tabview" class="tabview">
                        <ul class="tabs">
                            <li><a href="#api-classes">Classes</a></li>
                            <li><a href="#api-modules">Modules</a></li>
                        </ul>
                
                        <div id="api-tabview-filter">
                            <input type="search" id="api-filter" placeholder="Type to filter APIs">
                        </div>
                
                        <div id="api-tabview-panel">
                            <ul id="api-classes" class="apis classes">
                                <li><a href="../classes/ConfController.html">ConfController</a></li>
                                <li><a href="../classes/Gruntfile.html">Gruntfile</a></li>
                            </ul>
                
                            <ul id="api-modules" class="apis modules">
                                <li><a href="../modules/copy.html">copy</a></li>
                                <li><a href="../modules/Grunt file.html">Grunt file</a></li>
                                <li><a href="../modules/jshint.html">jshint</a></li>
                                <li><a href="../modules/ng.html">ng</a></li>
                                <li><a href="../modules/ngMessages.html">ngMessages</a></li>
                                <li><a href="../modules/ngMock.html">ngMock</a></li>
                                <li><a href="../modules/ngMockE2E.html">ngMockE2E</a></li>
                                <li><a href="../modules/uglify.html">uglify</a></li>
                                <li><a href="../modules/yuidoc.html">yuidoc</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
                    Show:
                    <label for="api-show-inherited">
                        <input type="checkbox" id="api-show-inherited" checked>
                        Inherited
                    </label>
            
                    <label for="api-show-protected">
                        <input type="checkbox" id="api-show-protected">
                        Protected
                    </label>
            
                    <label for="api-show-private">
                        <input type="checkbox" id="api-show-private">
                        Private
                    </label>
                    <label for="api-show-deprecated">
                        <input type="checkbox" id="api-show-deprecated">
                        Deprecated
                    </label>
            
                </div>
            
            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
<h1 class="file-heading">File: yocto_modules/social/social.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
/**
 * Dependencies
 * @see : http://underscorejs.org/
 * @see : https://github.com/epeli/underscore.string
 * @see : http://nodejs.org/api/path.html
 * @see : https://www.npmjs.com/package/glob  
 * @author :  Mathieu ROBERT &lt;mathieu@yocto.re&gt;
 * @copyright : Yocto SAS, All right reserved
 */
 
var config        = require(&#x27;../../config/config&#x27;); 
var _             = require(&#x27;underscore&#x27;);
var _s            = require(&#x27;underscore.string&#x27;);
var logger        = require(config.yoctoModules(&#x27;logger&#x27;));
var db            = require(&#x27;../../config/database&#x27;);
var glob          = require(&#x27;glob&#x27;);
var path          = require(&#x27;path&#x27;);

// mixin underscore js ans underscore.string js to use the same namespace
_.mixin(_s.exports());

/**
 * Main Object
 */
var social = function() {};

/**
 * Default social function to generate content dynamicly for facebook share
 * @param (String), url to share and to use for build content
 * @param (Function), callback to for default response
 */
social.prototype.generateFacebookShare = function(host, url, callback) {
  var allPart   = _.words(url, &#x27;/&#x27;);
  var item      = _.last(allPart);
  var itemPart  = _.words(item, &#x27;.&#x27;);
  var ext       = _.last(itemPart);
  var endUrl    = _.first(itemPart);
  var items     = _.words(endUrl, &#x27;-&#x27;);
  items         = items.splice(1, 2);
  
  // extract needed data
  var reference = _.first(items);
  var category  = _.last(items);
  
  // get ad
  var ad = db.factory.getAd(&#x27;standard&#x27;);
  
  // get by reference
  ad.getByReference(db.factory, reference, function(data) {
    data          = _.first(JSON.parse(JSON.stringify(data.data)));
    var facebook  = [];
    var title     = null;
    
    // add title
    if (_.has(data, &#x27;title_ad&#x27;) &amp;&amp; !_.isEmpty(data.title_ad)) {
      title = data.title_ad;
      facebook.push({ key : &#x27;og:title&#x27;, value : data.title_ad });
    }

    // add description
    if (_.has(data, &#x27;description&#x27;) &amp;&amp; !_.isEmpty(data.description)) {
      facebook.push({ key : &#x27;og:description&#x27;, value : data.description });
    }

    // process pictures
    if (_.has(data, &#x27;reference&#x27;) &amp;&amp; !_.isNull(data.reference) &amp;&amp; !_.isEmpty(data.reference)) {
      var reference    = data.reference;
      var webMediaPath = _.join(&#x27;/&#x27;, &#x27;media/ad&#x27;, reference);
      var picturesPath = path.normalize(_.join(&#x27;/&#x27;, __dirname, &#x27;../../public&#x27;, webMediaPath));
      var pictures     = [];

      // parse rules
      glob(&#x27;*.*&#x27; , {
        cwd       : picturesPath,
        nosort    : false
      }, function (error, matches) {
        // parse all pictures
        _.each(matches, function (pitem) {
          // get the first item
          if (pitem.indexOf(&#x27;-0.&#x27;) &gt;= 0) {
            pitem = _.join(&#x27;/&#x27;, host, webMediaPath, pitem);
            facebook.push({ key : &#x27;og:image&#x27;, value : pitem });
          }
        });
        
        // call callback
        callback({ title : title, facebook : facebook });
      });      
    } else {
      callback({});
    }
  }, {});  
}

/**
 * Default social function to generate content dynamicly for facebook share normal share
 * @param (String), url to share and to use for build content
 * @param (Function), callback to for default response
 */
social.prototype.generateDefaultShare = function(host, url, callback, type) {
  var constants = null;
  var title     = &quot;&quot;;
  
  // check type and assign constants
  if (type == &#x27;facebook&#x27;) {
    if (_.has(config.app, &#x27;social&#x27;)) {
      if (_.has(config.app.social, &#x27;facebook&#x27;)) {
        constants = config.app.social.facebook;        
      }
    }
  }
  
  // is null ?
  if (!_.isNull(constants) &amp;&amp; !_.isUndefined(constants) &amp;&amp; !_.isEmpty(constants)) {    
    var data = [];
    _.each(constants, function(item, key) {
      
      // if image prefix it
      if (key == &#x27;image&#x27;) {
        item = _.join(&#x27;/&#x27;, host, item); 
      }
      
      // if a specific title was set
      if (key == &#x27;title&#x27;) {
        title = item;
      }
      
      data.push({ key : _.join(&#x27;:&#x27;, &#x27;og&#x27;, key), value : item });
    });
    
    callback({ title : title, facebook : data });
  }
}

/**
 * Expose Utils
 */
module.exports  = new social();

    </pre>
</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
